services:
  seekspider:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: seekspider
    ports:
      - "6059:8000"
    environment:
      # Database configuration (for scraper only)
      - POSTGRESQL_HOST=${POSTGRESQL_HOST}
      - POSTGRESQL_PORT=${POSTGRESQL_PORT:-5432}
      - POSTGRESQL_USER=${POSTGRESQL_USER}
      - POSTGRESQL_PASSWORD=${POSTGRESQL_PASSWORD}
      - POSTGRESQL_DATABASE=${POSTGRESQL_DATABASE}
      - POSTGRESQL_TABLE=${POSTGRESQL_TABLE:-seek_jobs}

      # AI API configuration (for post-processing)
      - AI_API_KEY=${AI_API_KEY}
      - AI_API_URL=${AI_API_URL}
      - AI_MODEL=${AI_MODEL}

      # Application configuration
      - PYTHONPATH=/app/pipeline:/app:/app/src:/app/scraper
      - PYTHONUNBUFFERED=1
      - TZ=Australia/Perth
      - OUTPUT_PATH=/app/output
      - DATA_PATH=/app/data
      - DATABASE_URL=sqlite:////app/data/plombery.db
    volumes:
      - ./.env:/app/.env:ro
      - ./output:/app/output
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
